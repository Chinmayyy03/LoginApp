<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="BalanceCertificateRG" language="groovy" pageWidth="605" pageHeight="842" columnWidth="565" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="a745b11e-c435-4a52-99b0-3877414f3d48">
	<property name="ireport.zoom" value="2.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="136"/>
	<parameter name="as_on_date" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="branch_code" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="report_title" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
    gl.glaccount_code,
    gl.description AS name,
    COUNT(a.account_code) AS ac,

    NVL(SUM(b.ledgerbalance),0) AS sumledger,

    NVL((
        SELECT SUM(
            h.openingbalance +
            h.creditcash +
            h.credittransfer +
            h.creditclearing -
            (h.debitcash +
             h.debittransfer +
             h.debitclearing)
        )
        FROM balance.BRANCHGLHISTORY h
        WHERE h.txn_date = TO_DATE($P{as_on_date},'DD-MM-YYYY')
        AND h.glaccount_code = gl.glaccount_code
        AND h.branch_code = $P{branch_code}
    ),0) AS opbal,

    NVL(
        NVL(SUM(b.ledgerbalance),0) -
        NVL((
            SELECT SUM(
                h.openingbalance +
                h.creditcash +
                h.credittransfer +
                h.creditclearing -
                (h.debitcash +
                 h.debittransfer +
                 h.debitclearing)
            )
            FROM balance.BRANCHGLHISTORY h
            WHERE h.txn_date = TO_DATE($P{as_on_date},'DD-MM-YYYY')
            AND h.glaccount_code = gl.glaccount_code
            AND h.branch_code = $P{branch_code}
        ),0)
    ,0) AS diff

FROM balance.ACCOUNT b
JOIN account.account a
     ON b.account_code = a.account_code
JOIN accountlink.PRODUCT2ACCOUNT p
     ON SUBSTR(a.account_code,5,3) = p.product_code
JOIN headoffice.GLACCOUNT gl
     ON p.glaccount_code = gl.glaccount_code

WHERE SUBSTR(a.account_code,1,4) = $P{branch_code}
AND b.ledgerbalance <> 0

GROUP BY gl.glaccount_code, gl.description
ORDER BY gl.glaccount_code]]>
	</queryString>
	<field name="GLACCOUNT_CODE" class="java.lang.String"/>
	<field name="NAME" class="java.lang.String"/>
	<field name="AC" class="java.math.BigDecimal"/>
	<field name="SUMLEDGER" class="java.math.BigDecimal"/>
	<field name="OPBAL" class="java.math.BigDecimal"/>
	<field name="DIFF" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="79" splitType="Stretch"/>
	</title>
	<pageHeader>
		<band height="35" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="31" splitType="Stretch">
			<line>
				<reportElement x="0" y="0" width="565" height="1" uuid="c2c0e252-2fa5-4af0-a23a-392cac8fe383"/>
			</line>
			<line>
				<reportElement x="0" y="30" width="565" height="1" uuid="276465c7-0ae2-416d-a582-0cf50fe90606"/>
			</line>
			<line>
				<reportElement x="0" y="0" width="1" height="30" uuid="298fc439-251f-4c84-a913-ba8804999576"/>
			</line>
			<line>
				<reportElement x="82" y="0" width="1" height="30" uuid="07520e6a-ea51-4408-998b-bb85c7753609"/>
			</line>
			<line>
				<reportElement x="224" y="0" width="1" height="30" uuid="a6e6051a-06c8-439f-9666-739927b3fc2e"/>
			</line>
			<line>
				<reportElement x="294" y="0" width="1" height="30" uuid="8f43789a-1232-4048-a6c6-300c8406bb6c"/>
			</line>
			<line>
				<reportElement x="391" y="1" width="1" height="30" uuid="8c0ad2d3-a898-44e3-aa46-fdbb8a81254d"/>
			</line>
			<line>
				<reportElement x="479" y="1" width="1" height="30" uuid="a1b32b1b-aa3c-450e-88b8-c84d73099392"/>
			</line>
			<line>
				<reportElement x="564" y="0" width="1" height="30" uuid="910d83f1-23fd-4f2c-9f7c-147acff52926"/>
			</line>
			<staticText>
				<reportElement x="82" y="1" width="142" height="30" uuid="92afcdd1-8e95-47c5-b2f8-d166fd785337"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[A/c Name]]></text>
			</staticText>
			<staticText>
				<reportElement x="225" y="1" width="69" height="29" uuid="b262f5c7-5579-4fdf-9772-d6cbabf96062"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[ No.A/c's]]></text>
			</staticText>
			<staticText>
				<reportElement x="294" y="1" width="97" height="30" uuid="189a9c7b-92c8-4039-b6c1-c8ff1dc5c73e"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total GL Balance]]></text>
			</staticText>
			<staticText>
				<reportElement x="391" y="1" width="88" height="29" uuid="9683df36-3440-4713-a3ca-1d57a9f245e6"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total Ledger Balance]]></text>
			</staticText>
			<staticText>
				<reportElement x="481" y="1" width="83" height="28" uuid="febe0f8d-c0dd-4474-9df0-26090de816c9"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[ Difference Amount]]></text>
			</staticText>
			<staticText>
				<reportElement x="1" y="1" width="81" height="29" uuid="f2819aae-173d-4dfd-a7d2-03fda0d78448"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[A/c Code]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="118" splitType="Stretch">
			<textField>
				<reportElement x="1" y="0" width="81" height="20" uuid="42bc9679-ebc6-4d6d-9c9d-3573b676db91"/>
				<textFieldExpression><![CDATA[$F{field}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="83" y="0" width="141" height="20" uuid="fb2f4e7c-f196-4801-8f46-0371e3f4be8d"/>
				<textFieldExpression><![CDATA[$F{field}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="225" y="0" width="69" height="20" uuid="16c5a4d4-9140-402f-ac99-91e9d8a2415d"/>
				<textFieldExpression><![CDATA[$F{field}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="295" y="0" width="96" height="20" uuid="889d9a75-5fae-4e8f-b2cb-4eb0c5193bbe"/>
				<textFieldExpression><![CDATA[$F{field}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="392" y="1" width="88" height="20" uuid="c5472e48-c123-4004-8313-a80ea25187f7"/>
				<textFieldExpression><![CDATA[$F{field}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="481" y="2" width="83" height="20" uuid="13ecda56-5057-4e4b-91c6-3ce65894e5dc"/>
				<textFieldExpression><![CDATA[$F{field}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="90" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="54" splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="42" splitType="Stretch"/>
	</summary>
</jasperReport>
